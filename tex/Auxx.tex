\documentclass[a4paper]{article}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{bussproofs}
\usepackage{mathtools}
\usepackage{verbatim}
\usepackage{dsfont}
\usepackage{mathabx}
\usepackage[all, 2cell]{xy}
\usepackage[all]{xy}
\usepackage{listings}
\newtheorem{defin}{Definition}
\newtheorem{lemma}{Lemma}
\newtheorem{theorem}{Theorem}
\date{}
\title{Auxx type system}
\begin{document}
\maketitle

\tableofcontents

\newpage

\section{Syntax}

\subsection{Basic terms}

\begin{defin} Literals

  $\mathbb{L}_{\bf auxx} ::= {\bf Number} \: | \: {\bf String} \: | \: {\bf FilePath}$
\end{defin}

Where ${\bf Number} = {\bf Integer} \sqcup {\bf Double} \sqcup  {\bf Word32} \sqcup \dots$;

\begin{defin} Name

  ${\bf Name}_{\bf auxx} ::= {\bf String}$

\end{defin}

\begin{defin} Terms

Let $\mathbb{V} = \{ x, y, z, \dots \}$ is the countable set of variables.

The set of terms $\mathbb{T}_{\bf auxx}$ is defined by the following grammar.

$\begin{array}{lll}
&\mathbb{T}_{\bf auxx} ::= \mathbb{V}& \\
&\quad\quad\quad\quad | \: \mathbb{L}_{\bf auxx}& \\
&\quad\quad\quad\quad | \: {\bf ProcCall} \: \mathbb{T}_{\bf auxx} \: \mathbb{T}_{\bf auxx}^{+}&\\
&\quad\quad\quad\quad | \: (\lambda \mathbb{V}. \mathbb{T}_{\bf auxx}) & \\
&\quad\quad\quad\quad | \: (\mathbb{T}_{\bf auxx} \: \mathbb{T}_{\bf auxx})& \\
&\quad\quad\quad\quad | \: \langle \mathbb{T}_{\bf auxx}, \mathbb{T}_{\bf auxx} \rangle&\\
&\quad\quad\quad\quad | \: \pi_i \mathbb{T}_{\bf auxx}, i \in \{ 1,2 \}& \\
&\quad\quad\quad\quad | \: \mathbb{T} &
\end{array}$

Where $\mathbb{T}_{\bf auxx}^{+} = \bigcup \limits_{i = 1}^{\infty} \mathbb{T}_{\bf auxx}^i$ is the set of
non-empty sequences of terms.

\end{defin}

\section{Typing rules}

\subsection{Basic types}

\begin{defin} Basic types

Let $\mathcal{T} = \{ \alpha, \beta, \gamma, \dots \}$ be the set of atomic types.

\end{defin}

\begin{defin} Types

$\begin{array}{lll}
&\mathcal{T}_{\bf auxx} ::= \mathcal{T}&\\
&\quad\quad\quad\quad | \: {\bf num} &\\
&\quad\quad\quad\quad | \: {\bf str} &\\
&\quad\quad\quad\quad | \: {\bf fp} &\\
&\quad\quad\quad\quad | \: {\bf name} &\\
&\quad\quad\quad\quad | \: \bigstar &\\
&\quad\quad\quad\quad | \: \Pi_{\mathbb{V} : \mathcal{T}_{\bf auxx}} \to \mathcal{T}_{\bf auxx}& \\
&\quad\quad\quad\quad | \: \Sigma_{\mathbb{V} : \mathcal{T}_{\bf auxx}} \times \mathcal{T}_{\bf auxx}& \\
&\quad\quad\quad\quad | \: {\bf ProcCall \:} \: {\bf Name} \: \mathcal{T}_{\bf auxx}&
\end{array}$

where $\mathcal{T}_{\bf auxx}^{+} = \bigcup \limits_{i = 1}^{\infty} \mathcal{T}_{\bf auxx}^i$ is the set of non-empty finite sequences of types.
\end{defin}

\begin{defin} Context

  Context $\Gamma$ is a finite set of type declarations $x : A$, where $x$ is a variable, $A$ is a type.

\end{defin}

\subsection{Derivation rules}

\begin{prooftree}
  \AxiomC{$ $}
  \UnaryInfC{$\Gamma, x : A \vdash x : A$}
\end{prooftree}

\subsubsection{Typing rules for Literals}

\begin{prooftree}
  \AxiomC{$ x \in \mathbb{L}_{\bf auxx} \land x \in {\bf Number}$}
  \UnaryInfC{$\Gamma \vdash x : {\bf num}$}
\end{prooftree}

\begin{prooftree}
  \AxiomC{$ x \in \mathbb{L}_{\bf auxx} \land x \in {\bf String}$}
  \UnaryInfC{$\Gamma \vdash x : {\bf str}$}
\end{prooftree}

\begin{prooftree}
  \AxiomC{$ x \in \mathbb{L}_{\bf auxx} \land x \in {\bf FilePath}$}
  \UnaryInfC{$\Gamma \vdash x : {\bf fp}$}
\end{prooftree}

\begin{prooftree}
  \AxiomC{$ \forall x \in {\bf Name}$}
  \UnaryInfC{$\Gamma \vdash x : {\bf name}$}
\end{prooftree}

\subsubsection{Dependent product}

\begin{minipage}{0.5\textwidth}
  \begin{flushleft}
    \begin{prooftree}
      \AxiomC{$\Gamma, x : A \vdash B : \bigstar$}
      \UnaryInfC{$\Gamma \vdash \Pi_{x : A} \to B : \bigstar$}
    \end{prooftree}
  \end{flushleft}
\end{minipage}
\begin{minipage}{0.5\textwidth}
  \begin{flushright}
    \begin{prooftree}
      \AxiomC{$\Gamma, x : A \vdash M : B$}
      \UnaryInfC{$\Gamma \vdash (\lambda x. M) : \Pi_{x : A} \to B$}
    \end{prooftree}

    \begin{prooftree}
      \AxiomC{$\Gamma \vdash M : \Pi_{x : A} \to B$}
      \AxiomC{$\Gamma \vdash N : A$}
      \BinaryInfC{$\Gamma \vdash M N : B [x := N]$}
    \end{prooftree}
  \end{flushright}
\end{minipage}

\subsubsection{Dependent sum}

\begin{minipage}{0.8\textwidth}
  \begin{flushleft}
    \begin{prooftree}
      \AxiomC{$\Gamma, x : A \vdash B : \bigstar$}
      \UnaryInfC{$\Gamma \vdash \Sigma_{x : A} \times B : \bigstar$}
    \end{prooftree}

    \begin{prooftree}
      \AxiomC{$\Gamma, x : A \vdash B : \bigstar$}
      \AxiomC{$\Gamma \vdash M : A$}
      \AxiomC{$\Gamma \vdash N : B [x := M]$}
      \TrinaryInfC{$\Gamma \vdash \langle M, N \rangle : \Sigma_{x : A} \times B$}
    \end{prooftree}
  \end{flushleft}
\end{minipage}
\begin{minipage}{0.2\textwidth}
  \begin{flushright}
    \begin{prooftree}
      \AxiomC{$\Gamma \vdash M : \Sigma_{x : A} \times B$}
      \UnaryInfC{$\Gamma \vdash \pi_1 M : A$}
    \end{prooftree}

    \begin{prooftree}
      \AxiomC{$\Gamma \vdash M : \Sigma_{x : A} \times B$}
      \UnaryInfC{$\Gamma \vdash \pi_2 M : B [x := \pi_1 M]$}
    \end{prooftree}
  \end{flushright}
\end{minipage}

\subsubsection{Special typing rules}

\begin{prooftree}
  \AxiomC{$\Gamma \vdash N : {\bf Name}$}
  \AxiomC{$\Gamma \vdash M_1 : A_1, \dots, \Gamma \vdash M_n : A_n$}
  \AxiomC{$n \in \omega \setminus \{ 0 \}$}
  \RightLabel{$\omega-{\bf rule}_1$}
  \TrinaryInfC{$\Gamma \vdash {\bf ProcCall} \: N \: M_1 \: \dots \: M_n : {\bf ProcCall} \: A_1 \: \dots \: A_n$}
\end{prooftree}

Where $(\forall i \in \{ 1, \dots, n \}) (\exists B_i \in \mathcal{T}_{\bf auxx}), (A_i \equiv \Sigma_{x : {\bf Name}} \times B_i) \vee (A_i \equiv B_i)$

\vspace{\baselineskip}

We will use below the short form $\vec{M}$ instead of $M_1 \: \dots \: M_n$

\begin{defin} Free variables

  \begin{itemize}
    \item $x \in \mathbb{V} \Rightarrow FV(x) = \{ x \}$
    \item $x \in \mathbb{L}_{\bf auxx} \Rightarrow FV(x) = \emptyset$
    \item ${\bf ProcCall \:} N \: M_1 \: \dots \: M_n = \bigcup \limits_{i = 1}^n FV(M_i)$
    \item $FV(\lambda x. M) = FV(M) \setminus \{ x \}$
    \item $FV(M N) = FV(M) \cup FV(N)$
    \item $FV(\langle M , N \rangle) = FV(M) \cup FV(N)$
    \item $FV (\pi_i \: M) = FV(M), i \in \{ 1, 2\}$
    \item $\tau \in \mathbb{T} \Rightarrow FV (\tau) = \emptyset$
    \item $FV (\bigstar) = \{ {\bf U} \}$
    \item $FV(\Pi_{x : A} \to B) = FV(B) \setminus \{ x \}$
    \item $FV(\Sigma_{x : A} \times B) = FV(B) \setminus \{ x \}$
  \end{itemize}
\end{defin}

\begin{defin} Substitution
  \begin{itemize}
    \item $x [y := N] = N$, $x = y$
    \item $x [y := N] = x$, $x \neq y$
    \item $x \in \mathbb{L}_{\bf auxx} \Rightarrow \forall x \in \mathbb{V}, x [y := N] = x$;
    \item $({\bf ProcCall \:} N \: \vec{M}) [y := N] = {\bf ProcCall \:} N \: (\vec{M} [y := N])$
    \item $(\lambda x. M) [y := N] = \lambda x. M [y := N], y \notin BV(M)$
    \item $(M P) [y := N] = (M [y := N]) (P [y := N])$
    \item $(\langle M , P \rangle) [y := N] = \langle M [y := N], P [y := N] \rangle$
    \item $(\pi_i \: M) [y := N] = \pi_i (M [y := N]), i \in \{ 1, 2\}$
    \item $\tau \in \mathbb{T} \vee \tau = {\bf U} \Rightarrow \forall x \in \mathbb{V}, \tau [y := N] = \tau$
    \item $(\Pi_{x : A} \to B) [y := N] = \Pi_{x : A} \to B [y := N]$
    \item $(\Sigma_{x : A} \times B) [y := N] = \Sigma_{x : A} \times B$
  \end{itemize}
\end{defin}
\section{Reduction}

\begin{defin} Operational semantics
\begin{itemize}
  \item
  \begin{prooftree}
    \AxiomC{$M_1 \rightarrow_{\beta} M_2$}
    \UnaryInfC{$M_1 \: N \rightarrow_{\beta} M_2 \: N$}
  \end{prooftree}
  \item
  \begin{prooftree}
    \AxiomC{$N_1 \rightarrow_{\beta} N_2$}
    \UnaryInfC{$M \: N_1 \rightarrow_{\beta} M \: N_2$}
  \end{prooftree}
  \item
  \begin{prooftree}
    \AxiomC{$M \rightarrow_{\beta} M^{'}$}
    \RightLabel{$x \in FV(M) \land x \in FV(M^{'})$}
    \UnaryInfC{$\lambda x. M \rightarrow_{\beta} \lambda x. M^{'}$}
  \end{prooftree}
  \item
  \begin{prooftree}
  \AxiomC{$ $}
  \UnaryInfC{$(\lambda x. M) N \to_{\beta} M [x := N]$}
  \end{prooftree}
  \item
  \begin{prooftree}
    \AxiomC{$M \rightarrow_{\beta} M^{'}$}
    \UnaryInfC{$\langle M, N\rangle \rightarrow_{\beta} \langle M^{'}, N\rangle$}
  \end{prooftree}
  \item
  \begin{prooftree}
    \AxiomC{$N \rightarrow_{\beta} N^{'}$}
    \UnaryInfC{$\langle M, N\rangle \rightarrow_{\beta} \langle M, N^{'}\rangle$}
  \end{prooftree}
  \item
  \item
  \begin{prooftree}
    \AxiomC{$M \rightarrow_{\beta} M^{'}$}
    \RightLabel{$i \in \{ 1,2 \}$}
    \UnaryInfC{$\pi_i M \rightarrow_{\beta} \pi_i M^{'}$}
  \end{prooftree}
  \item
  \begin{prooftree}
  \AxiomC{$M_i \rightarrow_{\beta} M_i^{'}$}
  \UnaryInfC{${\bf ProcCall} \: N \: M_1 \: \dots \: M_i \dots \: M_n \rightarrow_{\beta} {\bf ProcCall} \: N \: M_1 \: \dots \: M_i^{'} \dots \: M_n$}
  \end{prooftree}
  \item
  \begin{prooftree}
    \AxiomC{$B \rightarrow B^{'}$}
    \UnaryInfC{$\Pi_{x : A} \to B \rightarrow_{\beta} \Pi_{x : A} \to B^{'}$}
  \end{prooftree}
  \item
  \begin{prooftree}
    \AxiomC{$B \rightarrow B^{'}$}
    \UnaryInfC{$\Sigma_{x : A} \times B \rightarrow_{\beta} \Sigma_{x : A} \times B^{'}$}
  \end{prooftree}
\end{itemize}
\end{defin}

\begin{defin} Multistep $\beta$-reduction

  Multistep $\beta$-reduction $\twoheadrightarrow_{\beta}$ is a reflexive-transitive closure of $\beta$-reduction.
\end{defin}

\begin{lemma} Generation lemma

  \begin{itemize}
    \item If $\Gamma, x : A \vdash x : A$, then $x : A \in \Gamma$;
    \item If $\Gamma \vdash \Pi_{x : A} \to B : \bigstar$, then $\Gamma, x : A \vdash B : \bigstar$;
    \item If $\Gamma \vdash (\lambda x. M) : \Pi_{x : A} \to B$, then $\Gamma, x : A \vdash M : B$;
    \item If $\Gamma \vdash (M N) : B [x := N]$, then $\Gamma \vdash M :  \Pi_{x : A} \to B$ and $M : A$;
    \item If $\Gamma \vdash \Sigma_{x : A} \times B$, then $\Gamma, x : A \vdash B : \bigstar$;
    \item If $\Gamma \vdash \langle M , N \rangle : \Sigma_{x : A} \times B$, then $\Gamma, x : A \vdash B : \bigstar$, $\Gamma \vdash M : A$ and $\Gamma \vdash N : B [x := N]$;
    \item If $\Gamma \vdash \pi_1 M : A $, then $\Gamma \vdash M : \Sigma_{x : A} \times B$;
    \item If $\Gamma \vdash \pi_2 M : B [x := \pi_1 M]$, then $\Gamma \vdash M : \Sigma_{x : A} \times B$;
    \item If $\Gamma \vdash \Gamma \vdash {\bf ProcCall} \: N \: \vec{M} : {\bf ProcCall} \: \vec{A}$ for $n \in \omega \: \setminus \: \{ 0 \}$, where $n = |\vec{A}| = |\vec{M}|$,
    then $\Gamma \vdash N : Name$ and $\Gamma \vdash \vec{M} : \vec{A}$.
  \end{itemize}
\end{lemma}

\begin{proof}

  Obviously.

\end{proof}

\begin{lemma} Admissibility of structural rules

  \begin{itemize}
    \item Let $\Gamma \vdash M : A$ and $\Delta \subseteq \Gamma$, then $\Delta \vdash M : A$;
    \item Let $\Gamma \vdash M : A$, then $\Delta \vdash M : A$, where $\Delta = \{ x : A \: | \: x \in FV(M) \land A \in rng(\Gamma)\}$;
    \item Let $\Gamma, x : A \vdash M : B$ and $\Gamma \vdash N : A$, then $\Gamma \vdash M [x := N] : B$;
    \item Let $\Gamma \vdash M : A$ and $\Delta$ is a permutation of $\Gamma$, then $\Delta \vdash M : A$;
    \item Let $\Gamma \vdash M : A$ and $[\alpha := B]$ is a type substituion, then $\Gamma [\alpha := B] \vdash M : A [\alpha := B]$,
    where $\Gamma [\alpha := B] = \{ x_1 : A_1 [\alpha := B], \dots, x_n : A_n [\alpha := B]\}$.
  \end{itemize}
\end{lemma}

\begin{proof}
  $ $

  Let us consider cases with ${\bf ProcCall}$.

1) Let $\Gamma \vdash {\bf ProcCall} \: N \: \vec{M} : {\bf ProcCall} \: \vec{A}$
for an arbitrary $n \in \omega \: \setminus \: \{ 0 \}$, such that $n = |\vec{A}| = |\vec{M}|$.

By generation lemma $\Gamma \vdash N : {\bf Name}$ and $\Gamma \vdash \vec{M} : \vec{A}$.

By IH $\Delta \vdash N : {\bf Name}$ and $\Delta \vdash \vec{M} : \vec{A}$.

So $\Delta \vdash {\bf ProcCall} \: N \: \vec{M} : {\bf ProcCall} \: \vec{A}$ by $\omega$-rule.

\vspace{\baselineskip}

2) Let $\Gamma \vdash {\bf ProcCall} \: N \: \vec{M} : {\bf ProcCall} \: \vec{A}$.

By inversion of $\omega$-rule $\Gamma \vdash N : {\bf Name}$ and $\Gamma \vdash \vec{M} : \vec{A}$.

By IH $\vdash N : {\bf Name}$ and $\forall i \in \omega \setminus \{ 1, \dots, n \}, n = |vec{M}| = |vec{A}| \Rightarrow
\Delta_i \vdash M_i : A_i$, where $\Delta_i = \{ (x : A) \: | \: x \in FV(M_i) \land A \in rng(\Gamma)\}$.

Then $\Delta_1, \dots, \Delta_n \vdash {\bf ProcCall} \: N \: \vec{M} : {\bf ProcCall} \: \vec{A}$ by $\omega$-rule.

\vspace{\baselineskip}

3) Let $\Gamma, x : A \vdash {\bf ProcCall} \: N \: \vec{M} : {\bf ProcCall} \: \vec{A}$ and $\Gamma \vdash P : A$.

By inversion $\Gamma, x : A \vdash N : {\bf Name}$ and $\Gamma, x : A \vdash \vec{M} : \vec{A}$.

By IH $\Gamma \vdash N : {\bf Name}$ and $\Gamma \vdash (\vec{M} [x := N]) : \vec{A}$.

Then $\Gamma \vdash {\bf ProcCall} \: N \: \vec{M} : {\bf ProcCall} \vec{A}$ by $\omega$-rule.

\vspace{\baselineskip}

4) Obviously.

\vspace{\baselineskip}

5) Let $\Gamma \vdash {\bf ProcCall} \: N \: \vec{M} : {\bf ProcCall} \: \vec{A}$.

By generation lemma $\Gamma \vdash N : {\bf Name}$ and $\Gamma \vdash \vec{M} : \vec{A}$.

By assumption, $\Gamma [\alpha := B] \vdash N : {\bf Name}$ and $\Gamma \vdash \vec{M} : (\vec{A} [y := B])$.

Then, by $\omega$-rule, $\Gamma [\alpha := B] \vdash {\bf ProcCall} \: N \: \vec{M} : {\bf ProcCall} \: N \: (\vec{A} [y := B])$.
\end{proof}

\begin{theorem} Subject reduction

  If $\Gamma \vdash M : A$ and $M \twoheadrightarrow_{\beta} N$, then $\Gamma \vdash N : A$.
\end{theorem}

\begin{proof}

Induction on generation of $\rightarrow_{\beta}$. The general statement follows from transitivity of
multistep $\beta$-reduction.

Let us consider case with ${\bf ProcCall}$.

Let $n \in \omega \setminus \{ 0 \}$ and $\Gamma \vdash {\bf ProcCall} \: N \: M_1 \: \dots \: M_n : {\bf ProcCall} \: A_1 \: \dots \: A_n$.

By generation, $\Gamma \vdash N : {\bf Name}$ and $\forall i \in \{ 1, \dots, n\}, \Gamma \vdash M_i$.

Let $(\exists j \in \{ 1, \dots, n \}) (\exists M^{'} \in \mathcal{T}_{\bf auxx}), M_j \twoheadrightarrow_{\beta} M^{'}$.

By IH, $\Gamma \vdash M^{'} : A_j$.

Then, by $\omega$-rule, $\Gamma \vdash {\bf ProcCall \:} N \: M_1 \dots M_{j - 1} \: M^{'} \: M_{j+1} \dots M_n : {\bf ProcCall} \: A_1 \: \dots \: A_n$.
\end{proof}

\end{document}
